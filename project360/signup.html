<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MV Electronics - Sign Up</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="login.css">
  <script>
      function updateFileName() {
          const input = document.getElementById('customFile');
          const label = document.getElementById('fileLabel');

          if (input.files.length > 0) {
              label.textContent = input.files[0].name; 
          } else {
              label.textContent = "Upload Your Image";
          }
      }

      // Client-side validation
      function validateForm() {
          const form = document.getElementById('signupForm');
          const firstName = form.elements['first_name'].value.trim();
          const lastName = form.elements['last_name'].value.trim();
          const username = form.elements['user_name'].value;
          const email = form.elements['email'].value;
          const password = form.elements['password'].value;
          const imageFile = document.getElementById('customFile').files[0];
          
          let isValid = true;
          let errorMessages = [];

          // First name validation (at least 2 characters and letters/spaces only)
          if (firstName.length < 2) {
              errorMessages.push("First name must be at least 2 characters long");
              isValid = false;
          }
          if (!/^[A-Za-z\s]+$/.test(firstName)) {
              errorMessages.push("First name can only contain letters and spaces");
              isValid = false;
          }
          
          // Last name validation (at least 2 characters and letters/spaces only)
          if (lastName.length < 2) {
              errorMessages.push("Last name must be at least 2 characters long");
              isValid = false;
          }
          if (!/^[A-Za-z\s]+$/.test(lastName)) {
              errorMessages.push("Last name can only contain letters and spaces");
              isValid = false;
          }

          // Username validation (3-30 characters, alphanumeric with spaces)
          if (username.length < 3 || username.length > 30) {
              errorMessages.push("Username must be between 3 and 30 characters");
              isValid = false;
          }
          
          if (!/^[a-zA-Z0-9\s]+$/.test(username)) {
              errorMessages.push("Username can only contain letters, numbers, and spaces");
              isValid = false;
          }

          // Password validation (min 8 chars, at least 1 uppercase, 1 lowercase, 1 number)
          if (password.length < 8) {
              errorMessages.push("Password must be at least 8 characters long");
              isValid = false;
          }
          
          if (!/[A-Z]/.test(password)) {
              errorMessages.push("Password must contain at least one uppercase letter");
              isValid = false;
          }
          
          if (!/[a-z]/.test(password)) {
              errorMessages.push("Password must contain at least one lowercase letter");
              isValid = false;
          }
          
          if (!/[0-9]/.test(password)) {
              errorMessages.push("Password must contain at least one number");
              isValid = false;
          }

          // Image validation
          if (!imageFile) {
              errorMessages.push("Please upload an image file");
              isValid = false;
          } else {
              const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
              if (!validTypes.includes(imageFile.type)) {
                  errorMessages.push("Only JPG, JPEG, PNG & GIF files are allowed");
                  isValid = false;
              }

              if (imageFile.size > 25 * 1024 * 1024) {
                  errorMessages.push("Image file size must be less than 25MB");
                  isValid = false;
              }
          }

          // Display client-side validation errors if any
          if (!isValid) {
              showAlert('error', errorMessages.join('<br>'));
          }
          
          return isValid;
      }

      // Function to display alerts
      function showAlert(type, message) {
          // Remove any existing alerts
          const existingAlerts = document.querySelectorAll('.alert');
          existingAlerts.forEach(alert => alert.remove());
          
          // Create new alert
          const alertDiv = document.createElement('div');
          alertDiv.className = type === 'success' 
              ? 'alert alert-success alert-dismissible fade show' 
              : 'alert alert-danger alert-dismissible fade show';
          
          alertDiv.innerHTML = `
              ${message}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          `;
          
          // Insert alert at the top of the form
          const formContainer = document.querySelector('.form-container');
          formContainer.insertBefore(alertDiv, formContainer.firstChild);
          
          // Auto dismiss alert after 5 seconds
          setTimeout(() => {
              if (alertDiv.parentNode) {
                  const bsAlert = new bootstrap.Alert(alertDiv);
                  bsAlert.close();
              }
          }, 5000);
      }

      // Form submission with AJAX
      document.addEventListener('DOMContentLoaded', function() {
          const form = document.getElementById('signupForm');
          
          form.addEventListener('submit', function(e) {
              e.preventDefault();
              
              // Run client-side validation first
              if (!validateForm()) {
                  return false;
              }
              
              const formData = new FormData(form);
              
              fetch('signup.php', {
                  method: 'POST',
                  body: formData
              })
              .then(response => response.json())
              .then(data => {
                  showAlert(data.status, data.message);
                  
                  // If success, reset the form
                  if (data.status === 'success') {
                      form.reset();
                      document.getElementById('fileLabel').textContent = "Upload Your Image";
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  showAlert('error', 'A network error occurred. Please try again later.');
              });
          });
      });
  </script>
</head>
<body>
  <!--Header-->
  <div id="header"></div>
  <div class="container mt-4 ms-4">
    <!-- Breadcrumb -->
    <nav class="breadcrumb mb-4">
      <a class="breadcrumb-item text-decoration-none text-muted" href="home.php">Home</a>
      <a class="breadcrumb-item text-decoration-none text-muted" href="login.php">Log In</a>
      <span class="breadcrumb-item active text-secondary fw-bold" aria-current="page">Sign Up</span>
    </nav>
  </div>
  <!-- Signup Section -->
  <div class="container-fluid login-container">
    <div class="row align-items-center">
      <div class="col-md-6 d-flex flex-column justify-content-center align-items-center text-center text-md-start px-4 p-md-0">
        <img src="images/loginpagephoto.webp" alt="Shopping" class="img-fluid">
      </div>
      <div class="col-md-6 d-flex flex-column justify-content-center align-items-center text-center text-md-start py-4 p-md-0">
        <h2>Create an account</h2>
        <p>Enter your details below</p>
        <div class="form-container w-75">
          <!-- Alerts will be inserted here -->
          <form id="signupForm" enctype="multipart/form-data">
            <!-- First Name Field -->
            <div class="mb-3">
              <input type="text" class="form-control" name="first_name" placeholder="Enter first name" required>
              <small class="form-text text-muted">Enter your first name <span class="text-danger">*</span></small>
            </div>
            <!-- Last Name Field -->
            <div class="mb-3">
              <input type="text" class="form-control" name="last_name" placeholder="Enter last name" required>
              <small class="form-text text-muted">Enter your last name <span class="text-danger">*</span></small>
            </div>
            <!-- Username Field -->
            <div class="mb-3">
              <input type="text" class="form-control" name="user_name" placeholder="Enter user name" required>
              <small class="form-text text-muted">3-30 characters, letters, numbers and spaces only <span class="text-danger">*</span></small>
            </div>
            <!-- Email Field -->
            <div class="mb-3">
              <input type="email" class="form-control" name="email" placeholder="Email" required>
              <small class="form-text text-muted">Must be a unique email address <span class="text-danger">*</span></small>
            </div>
            <!-- Password Field -->
            <div class="mb-3">
              <input type="password" class="form-control" name="password" placeholder="Password" required>
              <small class="form-text text-muted">Minimum 8 characters, at least 1 uppercase letter, 1 lowercase letter, and 1 number <span class="text-danger">*</span></small>
            </div>
            <!-- Image Upload Field -->
            <div class="mb-3">
              <input type="file" id="customFile" name="image" class="d-none" accept="image/*" onchange="updateFileName()" required>
              <button type="button" class="btn btn-secondary w-100" onclick="document.getElementById('customFile').click();">
                <span id="fileLabel">Upload Your Image</span>
              </button>
              <small class="form-text text-muted">JPG, JPEG, PNG or GIF format only, max 25MB <span class="text-danger">*</span></small>
            </div>
            <!-- Submit Button -->
            <button type="submit" class="btn btn-danger w-100">Sign Up</button>
            <!-- Login Link -->
            <div class="row">
              <div class="col-md-6 text-center text-md-start mt-2 w-100">
                <a href="login.php" class="text-danger">Already have an account? Login instead</a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer will be loaded via hfload.js -->
  <div id="footer"></div>
  <script src="hfload.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
